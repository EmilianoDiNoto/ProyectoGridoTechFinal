<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Production</title>
	<link rel="stylesheet" href="css/sweetalert2.css">
	<link rel="stylesheet" href="css/material.min.css">
	<link rel="stylesheet" href="css/material-design-iconic-font.min.css">
	<link rel="stylesheet" href="css/jquery.mCustomScrollbar.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/productionstore.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<!-- SweetAlert2 (una sola versión) -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- Tus otros scripts locales -->
	<script src="js/material.min.js"></script>
	<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
	<script src="js/main.js"></script>
	<script src="js/production_datatable.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">


	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>



	<!-- Chart.js -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="js/jquery-1.11.2.min.js"><\/script>')</script>
	<script src="js/material.min.js"></script>
	<script src="js/sweetalert2.min.js"></script>
	<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
	<script src="js/main.js"></script>
	<script src="js/menuControl.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

	<!-- BOOTSTRAP -->
	<link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

	<!-- DataTables CSS -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.css">
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">

	<!-- DataTables JS -->
	<script type="text/javascript" src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.js"></script>
	<script type="text/javascript"
		src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

	<!--Libreria del Calendario Domingo a Sabado-->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
	<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

</head>

<body>
	<!-- Sidebar -->
	<aside id="sidebar">
		<div class="d-flex">
			<button class="toggle-btn" type="button">
				<i class="lni lni-grid-alt"></i>
			</button>
			<div class="sidebar-logo">
				<a href="#">Grido Tech Advance</a>
			</div>
		</div>
		<ul class="sidebar-nav">
			<li class="sidebar-item">
				<a href="home.html" class="sidebar-link">
					<i class="zmdi zmdi-view-dashboard"></i>
					<span>Inicio</span>
				</a>
			</li>
			<li class="sidebar-item">
				<a href="production.html" class="sidebar-link">
					<i class="zmdi zmdi-washing-machine"></i>
					<span>Declarar Producción</span>
				</a>
			</li>
			<li class="sidebar-item">
				<a href="productionTable.html" class="sidebar-link">
					<i class="zmdi zmdi-washing-machine"></i>
					<span>Producción Confirmada</span>
				</a>
			</li>
			<li class="sidebar-item">
				<a href="workOders.html" class="sidebar-link">
					<i class="zmdi zmdi-assignment"></i>
					<span>Órdenes de Trabajo</span>
				</a>
			</li>
			<li class="sidebar-item">
				<a href="#" class="sidebar-link collapsed has-dropdown" data-bs-toggle="collapse"
					data-bs-target="#materials" aria-expanded="false" aria-controls="materials">
					<i class="zmdi zmdi-case"></i>
					<span>Materiales</span>
				</a>
				<ul id="materials" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
					<li class="sidebar-item">
						<a href="materials.html" class="sidebar-link">Materiales</a>
					</li>
					<li class="sidebar-item">
						<a href="providers.html" class="sidebar-link">Materiales Descartados</a>
					</li>
					<li class="sidebar-item">
						<a href="payments.html" class="sidebar-link">Materiales Retenidos</a>
					</li>
				</ul>
			</li>
			<li class="sidebar-item">
				<a href="products.html" class="sidebar-link">
					<i class="zmdi zmdi-store"></i>
					<span>Productos</span>
				</a>
			</li>
			<li class="sidebar-item">
				<a href="productStore.html" class="sidebar-link">
					<i class="zmdi zmdi-store"></i>
					<span>Almacén</span>
				</a>
			</li>
		</ul>
	</aside>
	<section class="full-width main">
		<section>
			<div class="form-container">
				<div class="form-group">
					<label for="fechaDesde">Fecha Desde:</label>
					<input type="date" id="fechaDesde">
				</div>

				<div class="form-group">
					<label for="fechaHasta">Fecha Hasta:</label>
					<input type="date" id="fechaHasta">
				</div>

				<div class="form-group">
					<label for="material">Material:</label>
					<input type="text" id="material" list="materiales" placeholder="Ingrese material">
					<datalist id="materiales">
						<option value="DULCE DE LECHE P/SEMBRAR">
						<option value="TAPA GALLETA SABOR VAINILLA 17 CM">
						<option value="SALSA DULCE SABOR CHOCOLATE">
						<option value="DULCE DE LECHE C/CACAO P/SEMBRAR">
						<option value="GALLETAS MILKA MOUSSE">
						<option value="GALLETA OREO PICADA">
						<option value="PREPARADO ALMIBAR STANDART">
						<option value="HELADO DE CREMA AMERICANA">
						<option value="HELADO DE CHOCOLATE">
						<option value="HELADO DE DULCE DE LECHE">
					</datalist>
				</div>

				<button id="btnBuscar">Buscar</button>
			</div>
		</section>
		<br>
		<section>

			<div class="container">
				<div class="row d-flex justify-content-between">
					<div class="col-md-3">
						<H5 style="text-align: center;">STOCK INICIAL</H5>
						<p id="mensajeSinDatosSI" style="color: red; display: none;">MATERIAL SIN STOCK INICIAL
							REGISTRADO</p>

						<table id="productionStoreTableSI">
							<thead>
								<tr>
									<th>Fecha</th>
									<th>Turno</th>
									<th>Cantidad</th>
									<th>Responsable</th>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot>
								<tr>
									<th colspan="2" style="text-align: right;">Total:</th>
									<th id="totalCantidadSI" class="text-end">0 Kg</th>
									<th></th>
								</tr>
							</tfoot>
						</table>

					</div>
					<div class="col-md-3">
						<H5 style="text-align: center;">PEDIDOS</H5>
						<p id="mensajeSinDatos" style="color: red; display: none;">MATERIAL SIN PEDIDO REGISTRADO</p>

						<table id="productionStoreTable">
							<thead>
								<tr>
									<th>Fecha</th>
									<th>Turno</th>
									<th>Cantidad</th>
									<th>Responsable</th>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot>
								<tr>
									<th colspan="2" style="text-align: right;">Total:</th>
									<th id="totalCantidad" class="text-end">0 Kg</th>
									<th></th>
								</tr>
							</tfoot>
						</table>

					</div>

					<div class="col-md-3">
						<H5 style="text-align: center;">DEVOLUCIONES</H5>
						<p id="mensajeSinDatosD" style="color: red; display: none;">MATERIAL SIN DEVOLUCION REGISTRADA
						</p>

						<table id="productionStoreTableD">
							<thead>
								<tr>
									<th>Fecha</th>
									<th>Turno</th>
									<th>Cantidad</th>
									<th>Responsable</th>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot>
								<tr>
									<th colspan="2" style="text-align: right;">Total:</th>
									<th id="totalCantidadD" class="text-end">0 Kg</th>
									<th></th>
								</tr>
							</tfoot>
						</table>
					</div>

					<div class="col-md-3">
						<H5 style="text-align: center;">SCRAP</H5>
						<p id="mensajeSinDatosS" style="color: red; display: none;">MATERIAL SIN SCRAP REGISTRADA</p>

						<table id="productionStoreTableS">
							<thead>
								<tr>
									<th>Fecha</th>
									<th>Turno</th>
									<th>Cantidad</th>
									<th>Responsable</th>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot>
								<tr>
									<th colspan="2" style="text-align: right;">Total:</th>
									<th id="totalCantidadS" class="text-end">0 Kg</th>
									<th></th>
								</tr>
							</tfoot>
						</table>
					</div>
					<div class="col-md-3">
						<H5 style="text-align: center;">STOCK FINAL</H5>
						<p id="mensajeSinDatosSF" style="color: red; display: none;">MATERIAL SIN STOCK FINAL REGISTRADO
						</p>

						<table id="productionStoreTableSF">
							<thead>
								<tr>
									<th>Fecha</th>
									<th>Turno</th>
									<th>Cantidad</th>
									<th>Responsable</th>
								</tr>
							</thead>
							<tbody></tbody>
							<tfoot>
								<tr>
									<th colspan="2" style="text-align: right;">Total:</th>
									<th id="totalCantidadSF" class="text-end">0 Kg</th>
									<th></th>
								</tr>
							</tfoot>
						</table>

					</div>
				</div>
			</div>
		</section>
	</section>

	<script>
		//CALENDARIO
		document.addEventListener("DOMContentLoaded", function () {
			const fechaDesde = document.getElementById("fechaDesde");
			const fechaHasta = document.getElementById("fechaHasta");

			// Bloquear fechas anteriores en Fecha Hasta
			fechaDesde.addEventListener("change", function () {
				fechaHasta.min = fechaDesde.value;
			});

			// Intentar cambiar el inicio de semana a domingo en navegadores compatibles
			if (fechaDesde.showPicker) {
				fechaDesde.setAttribute("locale", "es");
				fechaHasta.setAttribute("locale", "es");
			} else {
				console.warn("El navegador no permite cambiar el inicio de semana.");
			}
		});

		//STOCK INICIAL
		$(document).ready(function () {
			var table = $('#productionStoreTableSI').DataTable({
				"processing": true,
				"serverSide": false,
				"ajax": {
					"url": "http://localhost:63152/api/ProductionStore/GetProductionStoreInitial",
					"type": "GET",
					"data": function (d) {
						d.fechaDesde = $('#fechaDesde').val();
						d.material = $('#material').val();
						d.movimiento = "STOCK INICIAL";

						console.log("Datos enviados a la API:", d); // 🔍 Depuración en consola
					},
					"dataSrc": function (json) {
						console.log("Respuesta de la API:", json); // 🔍 Verifica la respuesta de la API

						if (!json || json.length === 0) {
							$("#mensajeSinDatosSI").show(); // Muestra el mensaje si no hay datos
						} else {
							$("#mensajeSinDatosSI").hide(); // Oculta el mensaje si hay datos
						}

						actualizarTotal(json); // Llamar a la función para calcular el total

						return json;
					},
					"error": function (xhr, error, thrown) {
						console.error("Error en la petición AJAX:", xhr.status, xhr.responseText);
					}
				},
				"columns": [
					{
						data: "FECHAMOV",
						className: "text-center",
						render: function (data) {
							let date = new Date(data);
							return date.toLocaleDateString();
						}
					},
					{ "data": "TURNO" },
					{
						"data": "CANTIDAD",
						className: "text-end", // Alinear valores a la derecha
						render: function (data) {
							return new Intl.NumberFormat("es-ES").format(data) + " Kg"; // Agregar separador de miles
						}
					},
					{ "data": "RESPONSABLE" }
				],
				"dom": "t", // Oculta search, show entries, paginación y otros elementos
				"footerCallback": function (row, data, start, end, display) {
					actualizarTotal(data); // También actualiza el total al cargar la tabla
				}
			});

			// Evento para actualizar la tabla con los filtros dinámicos
			$('#btnBuscar').click(function () {
				console.log("Botón de búsqueda presionado 🚀"); // ✅ Depuración
				table.ajax.reload(); // Recargar la tabla con los nuevos filtros
			});

			// Función para calcular y mostrar el total de CANTIDAD
			function actualizarTotal(data) {
				let totalCantidad = data.reduce((sum, item) => sum + (parseFloat(item.CANTIDAD) || 0), 0);
				$("#totalCantidadSI").text(new Intl.NumberFormat("es-ES").format(totalCantidad) + " Kg");
			}
		});

		//PEDIDO
		$(document).ready(function () {
			var table = $('#productionStoreTable').DataTable({
				"processing": true,
				"serverSide": false,
				"ajax": {
					"url": "http://localhost:63152/api/ProductionStore/GetProductionStoreByDateRange",
					"type": "GET",
					"data": function (d) {
						d.fechaDesde = $('#fechaDesde').val();
						d.fechaHasta = $('#fechaHasta').val();
						d.material = $('#material').val();
						d.movimiento = "PEDIDO";

						console.log("Datos enviados a la API:", d); // 🔍 Depuración en consola
					},
					"dataSrc": function (json) {
						console.log("Respuesta de la API:", json); // 🔍 Verifica la respuesta de la API

						if (!json || json.length === 0) {
							$("#mensajeSinDatos").show(); // Muestra el mensaje si no hay datos
						} else {
							$("#mensajeSinDatos").hide(); // Oculta el mensaje si hay datos
						}

						actualizarTotal(json); // Llamar a la función para calcular el total

						return json;
					},
					"error": function (xhr, error, thrown) {
						console.error("Error en la petición AJAX:", xhr.status, xhr.responseText);
					}
				},
				"columns": [
					{
						data: "FECHAMOV",
						className: "text-center",
						render: function (data) {
							let date = new Date(data);
							return date.toLocaleDateString();
						}
					},
					{ "data": "TURNO" },
					{
						"data": "CANTIDAD",
						className: "text-end", // Alinear valores a la derecha
						render: function (data) {
							return new Intl.NumberFormat("es-ES").format(data) + " Kg"; // Agregar separador de miles
						}
					},
					{ "data": "RESPONSABLE" }
				],
				"dom": "t", // Oculta search, show entries, paginación y otros elementos
				"footerCallback": function (row, data, start, end, display) {
					actualizarTotal(data); // También actualiza el total al cargar la tabla
				}
			});

			// Evento para actualizar la tabla con los filtros dinámicos
			$('#btnBuscar').click(function () {
				console.log("Botón de búsqueda presionado 🚀"); // ✅ Depuración
				table.ajax.reload(); // Recargar la tabla con los nuevos filtros
			});

			// Función para calcular y mostrar el total de CANTIDAD
			function actualizarTotal(data) {
				let totalCantidad = data.reduce((sum, item) => sum + (parseFloat(item.CANTIDAD) || 0), 0);
				$("#totalCantidad").text(new Intl.NumberFormat("es-ES").format(totalCantidad) + " Kg");
			}
		});


		// DEVOLUCION
		$(document).ready(function () {
			var table = $('#productionStoreTableD').DataTable({
				"processing": true,
				"serverSide": false,
				"ajax": {
					"url": "http://localhost:63152/api/ProductionStore/GetProductionStoreByDateRange",
					"type": "GET",
					"data": function (d) {
						d.fechaDesde = $('#fechaDesde').val();
						d.fechaHasta = $('#fechaHasta').val();
						d.material = $('#material').val();
						d.movimiento = "DEVOLUCION";

						console.log("Datos enviados a la API:", d); // 🔍 Depuración en consola
					},
					"dataSrc": function (json) {
						console.log("Respuesta de la API:", json); // 🔍 Verifica la respuesta de la API

						if (!json || json.length === 0) {
							$("#mensajeSinDatosD").show(); // Muestra el mensaje si no hay datos
						} else {
							$("#mensajeSinDatosD").hide(); // Oculta el mensaje si hay datos
						}

						actualizarTotal(json); // Llamar a la función para calcular el total

						return json;
					},
					"error": function (xhr, error, thrown) {
						console.error("Error en la petición AJAX:", xhr.status, xhr.responseText);
					}
				},
				"columns": [
					{
						data: "FECHAMOV",
						className: "text-center",
						render: function (data) {
							let date = new Date(data);
							return date.toLocaleDateString();
						}
					},
					{ "data": "TURNO" },
					{
						"data": "CANTIDAD",
						className: "text-end", // Alinear valores a la derecha
						render: function (data) {
							return new Intl.NumberFormat("es-ES").format(data) + " Kg"; // Agregar separador de miles
						}
					},
					{ "data": "RESPONSABLE" }
				],
				"dom": "t", // Oculta search, show entries, paginación y otros elementos
				"footerCallback": function (row, data, start, end, display) {
					actualizarTotal(data); // También actualiza el total al cargar la tabla
				}
			});

			// Evento para actualizar la tabla con los filtros dinámicos
			$('#btnBuscar').click(function () {
				console.log("Botón de búsqueda presionado 🚀"); // ✅ Depuración
				table.ajax.reload(); // Recargar la tabla con los nuevos filtros
			});

			// Función para calcular y mostrar el total de CANTIDAD
			function actualizarTotal(data) {
				let totalCantidad = data.reduce((sum, item) => sum + (parseFloat(item.CANTIDAD) || 0), 0);
				$("#totalCantidadD").text(new Intl.NumberFormat("es-ES").format(totalCantidad) + " Kg");
			}
		});


		// SCRAP
		$(document).ready(function () {
			var table = $('#productionStoreTableS').DataTable({
				"processing": true,
				"serverSide": false,
				"ajax": {
					"url": "http://localhost:63152/api/ProductionStore/GetProductionStoreByDateRange",
					"type": "GET",
					"data": function (d) {
						d.fechaDesde = $('#fechaDesde').val();
						d.fechaHasta = $('#fechaHasta').val();
						d.material = $('#material').val();
						d.movimiento = "SCRAP";

						console.log("Datos enviados a la API:", d); // 🔍 Depuración en consola
					},
					"dataSrc": function (json) {
						console.log("Respuesta de la API:", json); // 🔍 Verifica la respuesta de la API

						if (!json || json.length === 0) {
							$("#mensajeSinDatosS").show(); // Muestra el mensaje si no hay datos
						} else {
							$("#mensajeSinDatosS").hide(); // Oculta el mensaje si hay datos
						}

						actualizarTotal(json); // Llamar a la función para calcular el total

						return json;
					},
					"error": function (xhr, error, thrown) {
						console.error("Error en la petición AJAX:", xhr.status, xhr.responseText);
					}
				},
				"columns": [
					{
						data: "FECHAMOV",
						className: "text-center",
						render: function (data) {
							let date = new Date(data);
							return date.toLocaleDateString();
						}
					},
					{ "data": "TURNO" },
					{
						"data": "CANTIDAD",
						className: "text-end", // Alinear valores a la derecha
						render: function (data) {
							return new Intl.NumberFormat("es-ES").format(data) + " Kg"; // Agregar separador de miles
						}
					},
					{ "data": "RESPONSABLE" }
				],
				"dom": "t", // Oculta search, show entries, paginación y otros elementos
				"footerCallback": function (row, data, start, end, display) {
					actualizarTotal(data); // También actualiza el total al cargar la tabla
				}
			});

			// Evento para actualizar la tabla con los filtros dinámicos
			$('#btnBuscar').click(function () {
				console.log("Botón de búsqueda presionado 🚀"); // ✅ Depuración
				table.ajax.reload(); // Recargar la tabla con los nuevos filtros
			});

			// Función para calcular y mostrar el total de CANTIDAD
			function actualizarTotal(data) {
				let totalCantidad = data.reduce((sum, item) => sum + (parseFloat(item.CANTIDAD) || 0), 0);
				$("#totalCantidadS").text(new Intl.NumberFormat("es-ES").format(totalCantidad) + " Kg");
			}
		});

		//STOCK FINAL
		$(document).ready(function () {
			var table = $('#productionStoreTableSF').DataTable({
				"processing": true,
				"serverSide": false,
				"ajax": {
					"url": "http://localhost:63152/api/ProductionStore/GetProductionStoreInitial",
					"type": "GET",
					"data": function (d) {
						d.fechaDesde = $('#fechaDesde').val();
						d.material = $('#material').val();
						d.movimiento = "STOCK FINAL";

						console.log("Datos enviados a la API:", d); // 🔍 Depuración en consola
					},
					"dataSrc": function (json) {
						console.log("Respuesta de la API:", json); // 🔍 Verifica la respuesta de la API

						if (!json || json.length === 0) {
							$("#mensajeSinDatosSF").show(); // Muestra el mensaje si no hay datos
						} else {
							$("#mensajeSinDatosSF").hide(); // Oculta el mensaje si hay datos
						}

						actualizarTotal(json); // Llamar a la función para calcular el total

						return json;
					},
					"error": function (xhr, error, thrown) {
						console.error("Error en la petición AJAX:", xhr.status, xhr.responseText);
					}
				},
				"columns": [
					{
						data: "FECHAMOV",
						className: "text-center",
						render: function (data) {
							let date = new Date(data);
							return date.toLocaleDateString();
						}
					},
					{ "data": "TURNO" },
					{
						"data": "CANTIDAD",
						className: "text-end", // Alinear valores a la derecha
						render: function (data) {
							return new Intl.NumberFormat("es-ES").format(data) + " Kg"; // Agregar separador de miles
						}
					},
					{ "data": "RESPONSABLE" }
				],
				"dom": "t", // Oculta search, show entries, paginación y otros elementos
				"footerCallback": function (row, data, start, end, display) {
					actualizarTotal(data); // También actualiza el total al cargar la tabla
				}
			});

			// Evento para actualizar la tabla con los filtros dinámicos
			$('#btnBuscar').click(function () {
				console.log("Botón de búsqueda presionado 🚀"); // ✅ Depuración
				table.ajax.reload(); // Recargar la tabla con los nuevos filtros
			});

			// Función para calcular y mostrar el total de CANTIDAD
			function actualizarTotal(data) {
				let totalCantidad = data.reduce((sum, item) => sum + (parseFloat(item.CANTIDAD) || 0), 0);
				$("#totalCantidadSF").text(new Intl.NumberFormat("es-ES").format(totalCantidad) + " Kg");
			}
		});

	</script>

	<!-- Librerías necesarias -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- CSS de DataTables -->
	<link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">

	<!-- JS de DataTables -->
	<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>

	<!-- Archivo JavaScript separado -->
	<script src="js/production1.js"></script>

</body>

</html>