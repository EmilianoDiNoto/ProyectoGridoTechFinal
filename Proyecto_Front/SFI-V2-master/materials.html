<!-- 
* Copyright 2018 Carlos Eduardo Alfaro Orellana
  https://www.youtube.com/c/CarlosAlfaro007
-->
<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Materials</title>
	<!-- <link rel="stylesheet" href="css/normalize.css"> -->
	<link rel="stylesheet" href="css/sweetalert2.css">
	<link rel="stylesheet" href="css/material.min.css">
	<link rel="stylesheet" href="css/material-design-iconic-font.min.css">
	<link rel="stylesheet" href="css/jquery.mCustomScrollbar.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/materials.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<!-- SweetAlert2 (una sola versión) -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- Tus otros scripts locales -->
	<script src="js/material.min.js"></script>
	<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
	<script src="js/main.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

</head>

<body>
	<!-- Notifications area -->
	<section class="full-width container-notifications">
		<div class="full-width container-notifications-bg btn-Notification"></div>
		<section class="NotificationArea">
			<div class="full-width text-center NotificationArea-title tittles">Notifications <i
					class="zmdi zmdi-close btn-Notification"></i></div>
			<a href="#" class="Notification" id="notifation-unread-1">
				<div class="Notification-icon"><i class="zmdi zmdi-accounts-alt bg-info"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle"></i>
						<strong>New User Registration</strong>
						<br>
						<small>Just Now</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-unread-1">Notification as UnRead</div>
			</a>
			<a href="#" class="Notification" id="notifation-read-1">
				<div class="Notification-icon"><i class="zmdi zmdi-cloud-download bg-primary"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle-o"></i>
						<strong>New Updates</strong>
						<br>
						<small>30 Mins Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-read-1">Notification as Read</div>
			</a>
			<a href="#" class="Notification" id="notifation-unread-2">
				<div class="Notification-icon"><i class="zmdi zmdi-upload bg-success"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle"></i>
						<strong>Archive uploaded</strong>
						<br>
						<small>31 Mins Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-unread-2">Notification as UnRead</div>
			</a>
			<a href="#" class="Notification" id="notifation-read-2">
				<div class="Notification-icon"><i class="zmdi zmdi-mail-send bg-danger"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle-o"></i>
						<strong>New Mail</strong>
						<br>
						<small>37 Mins Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-read-2">Notification as Read</div>
			</a>
			<a href="#" class="Notification" id="notifation-read-3">
				<div class="Notification-icon"><i class="zmdi zmdi-folder bg-primary"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle-o"></i>
						<strong>Folder delete</strong>
						<br>
						<small>1 hours Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-read-3">Notification as Read</div>
			</a>
		</section>
	</section>
	<!-- navLateral -->
	<section class="full-width navLateral">
		<div class="full-width navLateral-bg btn-menu"></div>
		<div class="full-width navLateral-body">
			<div class="full-width navLateral-body-logo text-center tittles">
				<i class="zmdi zmdi-close btn-menu"></i> Grido Tech Advance
			</div>
			<figure class="full-width navLateral-body-tittle-menu">
				<div>
					<img src="assets/img/Emi (sin Fondo).png" alt="Avatar" class="img-responsive">
				</div>
				<figcaption>
					<span>
						Emiliano Di Noto<br>
						<small>Administrador</small>
					</span>
				</figcaption>
			</figure>
			<nav class="full-width">
				<ul class="full-width list-unstyle menu-principal">
					<li class="full-width">
						<a href="home.html" class="full-width">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-view-dashboard"></i>
							</div>
							<div class="navLateral-body-cr">
								Inicio
							</div>
						</a>
					</li>
					<li class="full-width divider-menu-h"></li>
					<li class="full-width">
						<a href="production.html" class="full-width">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-washing-machine"></i>
							</div>
							<div class="navLateral-body-cr">
								Declarar Producción
							</div>
						</a>
					</li>

					<li class="full-width divider-menu-h"></li>
					<li class="full-width">
						<a href="workOders.html" class="full-width">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-washing-machine"></i>
							</div>
							<div class="navLateral-body-cr">
								Ordenes de Trabajo
							</div>
						</a>
					</li>
					<li class="full-width divider-menu-h"></li>
					<li class="full-width">

						<a href="#!" class="full-width btn-subMenu">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-case"></i>
							</div>
							<div class="navLateral-body-cr">
								Materiales
							</div>
							<span class="zmdi zmdi-chevron-left"></span>
						</a>
						<ul class="full-width menu-principal sub-menu-options">
							<li class="full-width">
								<a href="materials.html" class="full-width">
									<div class="navLateral-body-cl">
										<i class="zmdi zmdi-balance"></i>
									</div>
									<div class="navLateral-body-cr">
										Materiales
									</div>
								</a>
							</li>
							<li class="full-width">
								<a href="providers.html" class="full-width">
									<div class="navLateral-body-cl">
										<i class="zmdi zmdi-truck"></i>
									</div>
									<div class="navLateral-body-cr">
										Materiales Descartados
									</div>
								</a>
							</li>
							<li class="full-width">
								<a href="payments.html" class="full-width">
									<div class="navLateral-body-cl">
										<i class="zmdi zmdi-card"></i>
									</div>
									<div class="navLateral-body-cr">
										Materiales Retenidos
									</div>
								</a>
							</li>
						</ul>
					</li>
					<li class="full-width divider-menu-h"></li>
					<li class="full-width">
						<a href="products.html" class="full-width">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-washing-machine"></i>
							</div>
							<div class="navLateral-body-cr">
								Productos
							</div>
						</a>
					</li>
					<li class="full-width divider-menu-h"></li>
					<li class="full-width">
						<a href="productStore.html" class="full-width">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-store"></i>
							</div>
							<div class="navLateral-body-cr">
								Almacen
							</div>
						</a>
					</li>
					<li class="full-width divider-menu-h"></li>
					<!-- <li class="full-width">
						<a href="sales.html" class="full-width">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-shopping-cart"></i>
							</div>
							<div class="navLateral-body-cr">
								Informes
							</div>
						</a>
					</li>
					<li class="full-width divider-menu-h"></li> -->
					<li class="full-width">
						<a href="#!" class="full-width btn-subMenu">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-face"></i>
							</div>
							<div class="navLateral-body-cr">
								Gestión de Usuarios
							</div>
							<span class="zmdi zmdi-chevron-left"></span>
						</a>
						<ul class="full-width menu-principal sub-menu-options">
							<li class="full-width">
								<a href="admin.html" class="full-width">
									<div class="navLateral-body-cl">
										<i class="zmdi zmdi-account"></i>
									</div>
									<div class="navLateral-body-cr">
										Administradores
									</div>
								</a>
							</li>
							<li class="full-width">
								<a href="client.html" class="full-width">
									<div class="navLateral-body-cl">
										<i class="zmdi zmdi-accounts"></i>
									</div>
									<div class="navLateral-body-cr">
										Usuarios
									</div>
								</a>
							</li>
						</ul>
					</li>
					<li class="full-width">
						<a href="#!" class="full-width btn-subMenu">
							<div class="navLateral-body-cl">
								<i class="zmdi zmdi-wrench"></i>
							</div>
							<div class="navLateral-body-cr">
								Configuración
							</div>
							<span class="zmdi zmdi-chevron-left"></span>
						</a>
						<ul class="full-width menu-principal sub-menu-options">
							<li class="full-width">
								<a href="#!" class="full-width">
									<div class="navLateral-body-cl">
										<i class="zmdi zmdi-widgets"></i>
									</div>
									<div class="navLateral-body-cr">
										Opción 1
									</div>
								</a>
							</li>
							<li class="full-width">
								<a href="#!" class="full-width">
									<div class="navLateral-body-cl">
										<i class="zmdi zmdi-widgets"></i>
									</div>
									<div class="navLateral-body-cr">
										Opción 2
									</div>
								</a>
							</li>
						</ul>
					</li>
				</ul>
			</nav>
		</div>
	</section>
	<!-- pageContent -->
	<section class="full-width pageContent">
		<!-- navBar -->
		<div class="full-width navBar">
			<div class="full-width navBar-options">
				<i class="zmdi zmdi-swap btn-menu" id="btn-menu"></i>
				<div class="mdl-tooltip" for="btn-menu">Hide / Show MENU</div>
				<nav class="navBar-options-list">
					<ul class="list-unstyle">
						<li class="btn-Notification" id="notifications">
							<i class="zmdi zmdi-notifications"></i>
							<div class="mdl-tooltip" for="notifications">Notifications</div>
						</li>
						<li class="btn-exit" id="btn-exit">
							<i class="zmdi zmdi-power"></i>
							<div class="mdl-tooltip" for="btn-exit">LogOut</div>
						</li>
						<li class="text-condensedLight noLink"><small>Emiliano Di Noto</small></li>
						<li class="noLink">
							<figure>
								<img src="assets/img/Emi (sin Fondo).png" alt="Avatar" class="img-responsive">
							</figure>
						</li>
					</ul>
				</nav>
			</div>
		</div>
		<section class="full-width header-well">
			<div class="full-width header-well-icon">
				<!-- <i class="zmdi zmdi-washing-machine"></i> -->
			</div>
			<div class="full-width header-well-text">
				<p class="text-condensedLight">
					Listar materiales de almacen
				</p>
			</div>
		</section>
		</div>

		<div class="search-container">
			<input type="text" id="searchInput" placeholder="Buscar...">
			<select id="searchType">
				<option value="all">Buscar en Todo</option>
				<option value="codigo">Código</option>
				<option value="nombre">Nombre</option>
				<option value="precio">Precio</option>
			</select>
		</div>

		<div class="table-container">
			<table>
				<thead>
					<tr>
						<th>CODIGO</th>
						<th>MATERIAL</th>
						<th>STOCK MINIMO</th>
						<th>UNIDAD DE MEDIDA</th>
						<th>PRECIO POR KILO</th>

					</tr>
				</thead>
				<tbody id="materialsTableBody">
					<!-- Los datos se insertarán dinámicamente aquí -->
				</tbody>
			</table>
		</div>

		<script>
		// Variable global para almacenar todos los materiales
let allMaterials = [];

// Función para renderizar la tabla
function renderMaterials(materials) {
    const tbody = document.getElementById('materialsTableBody');
    tbody.innerHTML = '';

    if (materials.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="no-results">
                    No se encontraron resultados.
                </td>
            </tr>
        `;
        return;
    }

    materials.forEach((material) => {
        const row = `
            <tr>
                <td>${material.CODIGO || ''}</td>
                <td>${material.MATERIAL || ''}</td>
                <td>${material.STOCK_MIN || 0}</td>
                <td>${material.UM || ''}</td>
                <td>$${Number(material.PRECIO || 0).toFixed(2)}</td>
            </tr>
        `;
        tbody.innerHTML += row;
    });
}

// Función para obtener materiales de la API
function Get() {
    fetch("http://localhost:63152/api/Materials")
        .then(response => {
            if (!response.ok) {
                throw new Error('Error en la respuesta del servidor');
            }
            return response.json();
        })
        .then(data => {
            // Limpiar y formatear los datos recibidos
            allMaterials = data.map(material => ({
                MaterialID: material.MaterialID,
                CODIGO: material.CODIGO ? String(material.CODIGO).trim() : '',
                MATERIAL: material.MATERIAL ? String(material.MATERIAL).trim() : '',
                STOCK_MIN: material.STOCK_MIN ? Number(material.STOCK_MIN) : 0,
                UM: material.UM ? String(material.UM).trim() : '',
                PRECIO: material.PRECIO ? Number(material.PRECIO) : 0
            }));
            renderMaterials(allMaterials);
        })
        .catch(error => {
            console.error('Error al obtener los materiales:', error);
            Swal.fire({
                title: 'Error',
                text: 'No se pudieron cargar los materiales. Por favor, intente nuevamente.',
                icon: 'error'
            });
        });
}

// Función para filtrar materiales
function filterMaterials() {
    const searchInput = document.getElementById('searchInput').value.toLowerCase().trim();
    const searchType = document.getElementById('searchType').value;

    const filteredMaterials = allMaterials.filter(material => {
        const codigo = String(material.CODIGO).toLowerCase();
        const nombre = String(material.MATERIAL).toLowerCase();
        const precio = String(material.PRECIO).toLowerCase();

        switch (searchType) {
            case 'codigo':
                return codigo.includes(searchInput);
            case 'nombre':
                return nombre.includes(searchInput);
            case 'precio':
                return precio.includes(searchInput);
            default: // all
                return codigo.includes(searchInput) || 
                       nombre.includes(searchInput) || 
                       precio.includes(searchInput);
        }
    });

    renderMaterials(filteredMaterials);
}

// Configurar eventos de búsqueda
document.getElementById('searchInput').addEventListener('input', filterMaterials);
document.getElementById('searchType').addEventListener('change', filterMaterials);

// Cargar materiales al iniciar la página
document.addEventListener('DOMContentLoaded', Get);
		</script>
</body>

</html>