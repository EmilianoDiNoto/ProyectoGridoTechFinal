<!-- 
* Copyright 2018 Carlos Eduardo Alfaro Orellana
  https://www.youtube.com/c/CarlosAlfaro007
-->
<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Materials</title>
	<!-- <link rel="stylesheet" href="css/normalize.css"> -->
	<link rel="stylesheet" href="css/sweetalert2.css">
	<link rel="stylesheet" href="css/material.min.css">
	<link rel="stylesheet" href="css/material-design-iconic-font.min.css">
	<link rel="stylesheet" href="css/jquery.mCustomScrollbar.css">
	<link rel="stylesheet" href="css/main.css">
	<link rel="stylesheet" href="css/materials.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


	<!-- BOOTSTRAP -->
	<link href="https://cdn.lineicons.com/4.0/lineicons.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

	<!-- SweetAlert2 (una sola versión) -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- Tus otros scripts locales -->
	<script src="js/material.min.js"></script>
	<script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
	<script src="js/main.js"></script>
	<script src="js/menuControl.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

	<!-- DataTables CSS -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.css">
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
	<link rel="stylesheet" type="text/css"
		href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">

	<!-- DataTables JS -->
	<script type="text/javascript" src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.js"></script>
	<script type="text/javascript"
		src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>

</head>

<body>
	<!-- Notifications area -->
	<section class="full-width container-notifications">
		<div class="full-width container-notifications-bg btn-Notification"></div>
		<section class="NotificationArea">
			<div class="full-width text-center NotificationArea-title tittles">Notifications <i
					class="zmdi zmdi-close btn-Notification"></i></div>
			<a href="#" class="Notification" id="notifation-unread-1">
				<div class="Notification-icon"><i class="zmdi zmdi-accounts-alt bg-info"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle"></i>
						<strong>New User Registration</strong>
						<br>
						<small>Just Now</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-unread-1">Notification as UnRead</div>
			</a>
			<a href="#" class="Notification" id="notifation-read-1">
				<div class="Notification-icon"><i class="zmdi zmdi-cloud-download bg-primary"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle-o"></i>
						<strong>New Updates</strong>
						<br>
						<small>30 Mins Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-read-1">Notification as Read</div>
			</a>
			<a href="#" class="Notification" id="notifation-unread-2">
				<div class="Notification-icon"><i class="zmdi zmdi-upload bg-success"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle"></i>
						<strong>Archive uploaded</strong>
						<br>
						<small>31 Mins Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-unread-2">Notification as UnRead</div>
			</a>
			<a href="#" class="Notification" id="notifation-read-2">
				<div class="Notification-icon"><i class="zmdi zmdi-mail-send bg-danger"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle-o"></i>
						<strong>New Mail</strong>
						<br>
						<small>37 Mins Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-read-2">Notification as Read</div>
			</a>
			<a href="#" class="Notification" id="notifation-read-3">
				<div class="Notification-icon"><i class="zmdi zmdi-folder bg-primary"></i></div>
				<div class="Notification-text">
					<p>
						<i class="zmdi zmdi-circle-o"></i>
						<strong>Folder delete</strong>
						<br>
						<small>1 hours Ago</small>
					</p>
				</div>
				<div class="mdl-tooltip mdl-tooltip--left" for="notifation-read-3">Notification as Read</div>
			</a>
		</section>
	</section>
	<div class="wrapper">
		<!-- Sidebar -->
		<aside id="sidebar">
			<div class="d-flex">
				<button class="toggle-btn" type="button">
					<i class="lni lni-grid-alt"></i>
				</button>
				<div class="sidebar-logo">
					<a href="#">Grido Tech Advance</a>
				</div>
			</div>
			<ul class="sidebar-nav">
				<li class="sidebar-item">
					<a href="home.html" class="sidebar-link">
						<i class="zmdi zmdi-view-dashboard"></i>
						<span>Inicio</span>
					</a>
				</li>
				<li class="sidebar-item">
					<a href="production.html" class="sidebar-link">
						<i class="zmdi zmdi-washing-machine"></i>
						<span>Declarar Producción</span>
					</a>
				</li>
				<li class="sidebar-item">
					<a href="workOders.html" class="sidebar-link">
						<i class="zmdi zmdi-assignment"></i>
						<span>Órdenes de Trabajo</span>
					</a>
				</li>
				<li class="sidebar-item">
					<a href="#" class="sidebar-link collapsed has-dropdown" data-bs-toggle="collapse"
						data-bs-target="#materials" aria-expanded="false" aria-controls="materials">
						<i class="zmdi zmdi-case"></i>
						<span>Materiales</span>
					</a>
					<ul id="materials" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#sidebar">
						<li class="sidebar-item">
							<a href="materials.html" class="sidebar-link">Materiales</a>
						</li>
						<li class="sidebar-item">
							<a href="providers.html" class="sidebar-link">Materiales Descartados</a>
						</li>
						<li class="sidebar-item">
							<a href="payments.html" class="sidebar-link">Materiales Retenidos</a>
						</li>
					</ul>
				</li>
				<li class="sidebar-item">
					<a href="products.html" class="sidebar-link">
						<i class="zmdi zmdi-store"></i>
						<span>Productos</span>
					</a>
				</li>
				<li class="sidebar-item">
					<a href="productStore.html" class="sidebar-link">
						<i class="zmdi zmdi-store"></i>
						<span>Almacén</span>
					</a>
				</li>
			</ul>
		</aside>
	
		<!-- Main Content -->
		<div class="main">
			<!-- NavBar -->
			<div class="navBar">
				<div class="navBar-options">
					<nav class="navBar-options-list">
						<ul class="list-unstyle">
							<li class="btn-Notification" id="notifications">
								<i class="zmdi zmdi-notifications"></i>
								<div class="mdl-tooltip" for="notifications">Notifications</div>
							</li>
							<li class="btn-exit" id="btn-exit">
								<i class="zmdi zmdi-power"></i>
								<div class="mdl-tooltip" for="btn-exit">LogOut</div>
							</li>
							<li class="text-condensedLight noLink"><small>Emiliano Di Noto</small></li>
							<li class="noLink">
								<figure>
									<img src="assets/img/Emi (sin Fondo).png" alt="Avatar" class="img-responsive">
								</figure>
							</li>
						</ul>
					</nav>
				</div>
			</div>
	
			<!-- Header -->
			<div class="header-well">
				<div class="header-well-icon">
					<!-- <i class="zmdi zmdi-washing-machine"></i> -->
				</div>
				<div class="header-well-text">
					<p class="text-condensedLight">
						Listar materiales de almacen
					</p>
				</div>
			</div>
	
			<!-- Table Container -->
			<div class="table-container">
				<table id="materialsTable" class="display responsive nowrap" style="width:100%">
					<thead>
						<tr>
							<th>CODIGO</th>
							<th>MATERIAL</th>
							<th>STOCK MINIMO</th>
							<th>UNIDAD DE MEDIDA</th>
							<th>PRECIO POR KILO</th>
						</tr>
					</thead>
					<tbody id="materialsTableBody">
						<!-- Los datos se insertarán dinámicamente aquí -->
					</tbody>
				</table>
			</div>
		</div>
	</div>

		<script>
			// Agregar esto al inicio de tu script, antes de la definición de initializeDataTable
			document.addEventListener('DOMContentLoaded', function () {
				// Referencias a elementos
				const sidebar = document.querySelector('.sidebar');
				const mainContent = document.querySelector('.main-content');
				const toggleBtn = document.querySelector('.toggle-btn');
				const submenuToggles = document.querySelectorAll('.submenu-toggle');

				// Verificar que existan los elementos necesarios
				if (!sidebar || !mainContent || !toggleBtn) {
					console.error('No se encontraron los elementos necesarios del sidebar');
					return;
				}

				// Función para ajustar la tabla
				function adjustTable() {
					if (window.materialsTable) {
						setTimeout(() => {
							window.materialsTable.columns.adjust().responsive.recalc();
						}, 300);
					}
				}

				// Toggle sidebar
				if (toggleBtn) {
					toggleBtn.addEventListener('click', () => {
						sidebar.classList.toggle('collapsed');
						mainContent.classList.toggle('expanded');
						adjustTable();
					});
				}

				// Toggle submenus
				submenuToggles.forEach(toggle => {
					toggle.addEventListener('click', (e) => {
						e.preventDefault();
						if (!sidebar.classList.contains('collapsed')) {
							const parent = toggle.parentElement;
							parent.classList.toggle('active');
						}
					});
				});

				// Manejar resize de la ventana
				window.addEventListener('resize', adjustTable);
			});




			let materialsTable;

			function initializeDataTable(data) {
				if (materialsTable) {
					materialsTable.destroy();
				}

				materialsTable = $('#materialsTable').DataTable({
					data: data,
					columns: [
						{ data: 'CODIGO' },
						{ data: 'MATERIAL' },
						{ data: 'STOCK_MIN' },
						{ data: 'UM' },
						{
							data: 'PRECIO',
							render: function (data) {
								return `$${Number(data).toFixed(2)}`;
							}
						}
					],
					responsive: true,
					dom: 'Bfrtip',
					buttons: [
						{
							extend: 'excel',
							text: 'Exportar a Excel',
							className: 'btn btn-success',
							exportOptions: {
								columns: [0, 1, 2, 3, 4]
							}
						}
					],
					language: {
						url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
					},
					pageLength: 10,
					order: [[0, 'asc']],
					columnDefs: [
						{
							targets: 4,
							className: 'text-right'
						}
					],
					drawCallback: function () {
						// Solo ajustar si la tabla existe y tiene el método adjust
						if (this.api) {
							this.api().columns.adjust();
							if (this.api().responsive) {
								this.api().responsive.recalc();
							}
						}
					}
				});

				// Hacer la tabla globalmente accesible
				window.materialsTable = materialsTable;
			}

			function Get() {
				fetch("http://localhost:63152/api/Materials")
					.then(response => {
						if (!response.ok) {
							throw new Error('Error en la respuesta del servidor');
						}
						return response.json();
					})
					.then(data => {
						// Limpiar y formatear los datos recibidos
						const formattedData = data.map(material => ({
							MaterialID: material.MaterialID,
							CODIGO: material.CODIGO ? String(material.CODIGO).trim() : '',
							MATERIAL: material.MATERIAL ? String(material.MATERIAL).trim() : '',
							STOCK_MIN: material.STOCK_MIN ? Number(material.STOCK_MIN) : 0,
							UM: material.UM ? String(material.UM).trim() : '',
							PRECIO: material.PRECIO ? Number(material.PRECIO) : 0
						}));

						initializeDataTable(formattedData);
					})
					.catch(error => {
						console.error('Error al obtener los materiales:', error);
						Swal.fire({
							title: 'Error',
							text: 'No se pudieron cargar los materiales. Por favor, intente nuevamente.',
							icon: 'error'
						});
					});
			}

			// Cargar materiales al iniciar la página
			document.addEventListener('DOMContentLoaded', Get);



		</script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
			crossorigin="anonymous"></script>
		</section>
	</div>

</body>

</html>