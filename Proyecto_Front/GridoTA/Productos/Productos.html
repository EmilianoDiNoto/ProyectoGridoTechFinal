<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Modern Admin Dashboard</title>
  <link rel="stylesheet" href="../CSS/estilos_iniciales.css" />
  <link rel="stylesheet" href="../Modal/modal-crud/dist/style.css">

  <script src="https://kit.fontawesome.com/417062404a.js" crossorigin="anonymous"></script>

  <link rel="stylesheet"
    href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css" />
  <!-- jQuery Completo -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <!-- Bootstrap (si es necesario) -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <!-- Tempus Dominus -->
  <script src="path/to/tempusdominus-bootstrap-4.min.js"></script>


  <!-- time picker library -->

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />
  <!-- font awesome -->
  <script src="https://kit.fontawesome.com/44e24fc4d2.js"></script>

  



  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../CSS/estilos_iniciales.css">


</head>

<body>
  <input type="checkbox" id="menu-toggle" />

  <div class="sidebar">
    <div class="side-header">
      <h3>H<span>ELACOR</span></h3>
    </div>
    <div class="side-content">
      <div class="profile">
        <div class="profile-img bg-img" style="background-image: url('../img/mujer-de-negocios.png')"></div>
        <h4>Diana Zavaleta</h4>
        <small>Administradora</small>
      </div>
      <div class="side-menu">
        <ul>
          <li>
            <a href="#" class="active">
              <span class="las la-home"></span>
              <small>Inicio</small>
            </a>
            <ul class="submenu">
              <li>
                <a href="../Login.html">INICIAR SESION</a>
              </li>
              <li>
                <a href="#">PANEL DE CONTROL</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#">
              <span class="las la-clipboard-list"></span>
              <small>Inventario</small>
            </a>
            <ul class="submenu">
              <li>
                <a href="../Inventario/inventario.html">CONSULTAR INVENTARIO</a>
              </li>
              <li>
                <a href="../Por_hacer/ajuste-invent.html">REALIZAR AJUSTE DE INVENTARIO</a>
              </li>
              <li>
                <a href="../Por_hacer/registro-fin.html">REALIZAR MOVIMIENTO DE INVENTARIO</a>
              </li>
              <li>
                <a href="../Por_hacer/reg-mov-mat.html">CONSULTAR MOVIMIENTOS DE MATERIALES </a>
              </li>
              <li>
                <a href="../Por_hacer/Trazabilidad/trazabilidad-material.html">CONSULTAR TRAZABILIDAD</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#">
              <span class="las la-campground"></span>
              <small>Órdenes de Trabajo</small>
            </a>
            <ul class="submenu">
              <li>
                <a href="../Por_Hacer/insumos/listado_insumos.html">CONSULTAR INSUMOS</a>
              </li>
              <li>
                <a href="../Por_Hacer/gestion.html">Generar Solicitud de Materiales</a>
              <!-- <li>
                <a href="#">CONFIRMACION DE PRODUCCION</a>
              </li> -->
            </ul>
          </li>
          <li>
            <a href="#">
              <span class="las la-clipboard-check"></span>
              <small>Reportes</small>
            </a>
            <ul class="submenu">
              <li>
                <a href="../Por_Hacer/listado.html">Generar Reporte de Inventario</a>
              </li>
              <li>
                <a href="../Por_Hacer/informe.html">Generar Reporte de Insumos</a>
              </li>
              <li>
                <a href="../Por_Hacer/informe-materiales.html">Generar Reporte de Materiales Retenidos y Descartados</a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#">
              <span class="las la-chart-line"></span>
              <small>Gráficos</small>
            </a>
            <ul class="submenu">
              <li><a href="#">Barras</a></li>
              <li><a href="#">Submenú 2</a></li>
              <li><a href="#">Submenú 3</a></li>
            </ul>
          </li>
          <li>
            <a href="#">
              <span class="las la-file-alt"></span>
              <small>Órdenes</small>
            </a>
            <ul class="submenu">
              <li><a href="../Por_Hacer/gestion.html">Prueba</a></li>
              <li><a href="#">Submenú 2</a></li>
              <li><a href="#">Submenú 3</a></li>
            </ul>
          </li>
          <li>
            <a href="#">
              <span class="las la-tasks"></span>
              <small>Tareas</small>
            </a>
            <ul class="submenu">
              <li><a href="#">Submenú 1</a></li>
              <li><a href="#">Submenú 2</a></li>
              <li><a href="#">Submenú 3</a></li>
            </ul>
          </li>
          <li>
            <a href="#">
              <span class="las la-cog"></span>
              <small>Configuración</small>
            </a>
            <ul class="submenu">
              <li><a href="../Por_Hacer/Usuarios/crear_usuario.html">Crear Nuevo Usuario</a></li>
              <li><a href="../Por_Hacer/Usuarios/lista de usuarios.html">Lista de Usuarios</a></li>
            </ul>
          </li>


        </ul>
      </div>
    </div>
  </div>

  <div class="main-content">
    <header>
      <div class="header-content">
        <label for="menu-toggle">
          <span class="las la-bars"></span>
        </label>

        <div class="header-menu">
          <label for="">
            <span class="las la-search"></span>
          </label>

          <div class="notify-icon">
            <span class="las la-envelope"></span>
            <span class="notify">4</span>
          </div>

          <div class="notify-icon">
            <span class="las la-bell"></span>
            <span class="notify">3</span>
          </div>

          <div class="user">
            <div class="bg-img" style="background-image: url(img/1.jpeg)"></div>

            <span class="las la-power-off"></span>
            <a href="../Login.html">Logout</a>
          </div>
        </div>
      </div>
    </header>

    <main>
      <div class="page-header">
        <h2 class="h2menu">Menú</h2>
        <small>Inicio</small>
      </div>

      <div class="page-content">
        <div class="analytics">
          <div class="card">
            <div class="card-head">
              <h2>200</h2>
              <span class="las la-signal"></span>
            </div>
            <div class="card-progress">
              <small>Existencia Actual</small>
              <div class="card-indicator">
                <div class="indicator one" style="width: 60%"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-head">
              <h2>400</h2>
              <span class="las la-shopping-bag"></span>
            </div>
            <div class="card-progress">
              <small>Existencia Total</small>
              <div class="card-indicator">
                <div class="indicator two" style="width: 80%"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-head">
              <h2>250</h2>
              <span class="las la-boxes"></span>
            </div>
            <div class="card-progress">
              <small>Stock</small>
              <div class="card-indicator">
                <div class="indicator three" style="width: 65%"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-head">
              <h2>100</h2>
              <span class="las la-undo-alt"></span>
            </div>
            <div class="card-progress">
              <small>Devoluciones</small>
              <div class="card-indicator">
                <div class="indicator four" style="width: 90%"></div>
              </div>
            </div>
          </div>
        </div>
        <h1>PRODUCTOS</h1>
        <br />

        <div class="records table-responsive">
          <div class="record-header">
            <div class="add">
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addMaterialModal" hidden>
                Agregar Material
              </button>
              <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editMaterialModal" hidden>
                Editar Material
              </button> 


            
              <div class="modal fade" id="addMaterialModal" tabindex="-1" role="dialog"
                aria-labelledby="addMaterialModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="addMaterialModalLabel">PRODUCTOS</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form id="addMaterialForm">
                        <div class="form-group">
                          <label for="materialName">Nombre de Material</label>
                          <input type="text" class="form-control" id="materialName"
                            placeholder="Ingrese nombre del material">
                        </div>
                        <div class="form-group">
                          <label for="materialDescription">Descripción</label>
                          <textarea class="form-control" id="materialDescription" rows="3"
                            placeholder="Ingrese descripción"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="supplier">Proveedor</label>
                          <select class="form-control" id="supplier">
                            <option value="1">Parnor</option>
                            <option value="2">Mondelez</option>
                            <option value="3">Savorisimo</option>
                            <option value="4">LiviamFerco</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="stockQuantity">Cantidad de Stock</label>
                          <input type="number" class="form-control" id="stockQuantity"
                            placeholder="Ingrese cantidad de stock">
                        </div>
                        <div class="form-group">
                          <label for="unit">Unidad de Medida</label>
                          <select class="form-control" id="unit">
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="L">L</option>
                            <option value="gr">gr</option>
                          </select>
                        </div>
                        <div class="form-group" align="center">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                          <button type="button" class="btn btn-primary" id="createMaterialBtn">Crear Material</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <div class="modal fade" id="editMaterialModal" tabindex="-1" role="dialog"
                aria-labelledby="editMaterialModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="editMaterialModalLabel">Editar Material</h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body">
                      <form>
                        <div class="form-group">
                          <label for="materialID">Material</label>
                          <select class="form-control" id="materialID">
                            <option value="1">Dulce con Cacao</option>
                            <option value="2">Galleta Oreo Picada</option>
                            <option value="3">Cacao</option>
                            <option value="5">Salsa de chocolate</option>
                            <option value="9">Galleta Milka Picada</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="editMaterialName">Nombre de Material</label>
                          <input type="text" class="form-control" id="editMaterialName"
                            placeholder="Ingrese nombre del material">
                        </div>
                        <div class="form-group">
                          <label for="editMaterialDescription">Descripción</label>
                          <textarea class="form-control" id="editMaterialDescription" rows="3"
                            placeholder="Ingrese descripción"></textarea>
                        </div>
                        <div class="form-group">
                          <label for="editSupplier">Proveedor</label>
                          <select class="form-control" id="editSupplier">
                            <option value="1">Parnor</option>
                            <option value="2">Mondelez</option>
                            <option value="3">Savorisimo</option>
                            <option value="4">LiviamFerco</option>
                          </select>
                        </div>
                        <div class="form-group">
                          <label for="editStockQuantity">Cantidad de Stock</label>
                          <input type="number" class="form-control" id="editStockQuantity"
                            placeholder="Ingrese cantidad de stock">
                        </div>
                        <div class="form-group">
                          <label for="editUnit">Unidad de Medida</label>
                          <select class="form-control" id="editUnit">
                            <option value="kg">kg</option>
                            <option value="ml">ml</option>
                            <option value="L">L</option>
                            <option value="gr">gr</option>
                          </select>
                        </div>
                        <div class="form-group" align="center">
                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                          <button type="button" class="btn btn-primary"
                            onclick="confirmUpdateMaterial()">Editar</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>





            </div>






            <div class="browse">
              <input type="search" placeholder="Search" class="record-search" />
              <select name="" id="">
                <option value="">Status</option>
              </select>
            </div>
          </div>

          <div>
            <table width="100%">
              <thead>
                <tr>
                  <th><span class="las la-sort"></span>Codigo</th>
                  <th><span class="las la-sort"></span>Producto</th>
                  <th><span class="las la-sort"></span>Descripción</th>
                  <th><span class="las la-sort"></span>Unidad de Medida</th>
                </tr>
              </thead>
              <tbody>
                 <tr>
                    <td>100</td>
                    <td>Caramelo doble concentracion</td>
                    <td>kg</td>
                    <td>Dulces</td>
                    <td>Almacen1</td>
                    <td>50</td>
                    <td>42</td>
                    <td>Solicitar material</td>
                    <td>
                      <div class="actions">
                        <span class="lab la-telegram-plane"></span>
                        <span class="las la-eye"></span>
                        <span class="las la-ellipsis-v"></span>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>101</td>
                    <td>Caramelo de menta</td>
                    <td>bolsa</td>
                    <td>Dulces</td>
                    <td>Almacen1</td>
                    <td>5</td>
                    <td>10</td>
                    <td>Hay suficiente</td>
                    <td>
                      <div class="actions">
                        <span class="lab la-telegram-plane"></span>
                        <span class="las la-eye"></span>
                        <span class="las la-ellipsis-v"></span>
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>102</td>
                    <td>Caramelo oscuro</td>
                    <td>bolsa</td>
                    <td>Dulces</td>
                    <td>Almacen1</td>
                    <td>0</td>
                    <td>0</td>
                    <td>Sin dato stock minimo</td>
                    <td>
                      <div class="actions">
                        <span class="lab la-telegram-plane"></span>
                        <span class="las la-eye"></span>
                        <span class="las la-ellipsis-v"></span>
                      </div>
                    </td>
                  </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <!-- Nav desplegable-->

 <script type="text/javascript">
    $(".nav").click(function () {
      $("#mySidenav").css("width", "70px");
      $("#main").css("margin-left", "70px");
      $(".logo").css("visibility", "hidden");
      $(".logo span").css("visibility", "visible");
      $(".logo span").css("margin-left", "-10px");
      $(".icon-a").css("visibility", "hidden");
      $(".icons").css("visibility", "visible");
      $(".icons").css("margin-left", "-8px");
      $(".nav").css("display", "none");
      $(".nav2").css("display", "block");
    });

    $(".nav2").click(function () {
      $("#mySidenav").css("width", "300px");
      $("#main").css("margin-left", "300px");
      $(".logo").css("visibility", "visible");
      $(".logo span").css("visibility", "visible");
      $(".icon-a").css("visibility", "visible");
      $(".icons").css("visibility", "visible");
      $(".nav").css("display", "block");
      $(".nav2").css("display", "none");
    });
  </script>

  <script>


    function Get() {
      fetch("http://localhost:63152/api/Products")
        .then((response) => response.json())
        .then((data) => {
          const tbody = document.querySelector(`tbody`);

          data.forEach((o) => {
            let _tr = `<tr>
                            <td>${o.CODIGO}</td>
                            <td>${o.PRODUCTO}</td>
                            <td>${o.DESCRIPCION}</td>
                            <td>${o.UM}</td>
                        </tr>`;

            tbody.innerHTML += _tr;
          });
        });
    }
    Get();
    document.getElementById("createMaterialBtn").addEventListener("click", addMaterial);

    function addMaterial() {
      // Obtener los valores de los campos del formulario
      const MaterialCod = document.getElementById("MaterialCod").value;
      const MaterialName = document.getElementById("MaterialName").value;
      const StockQuantity = document.getElementById("StockQuantity").value;
      const StockUnit = document.getElementById("StockUnit").value;
      const Price = document.getElementById("Price").value;

      // Crear objeto con los datos del material
      const newMaterial = {
        MaterialCod: MaterialCod,
        MaterialName: MaterialName,
        StockQuantity: parseInt(StockQuantity),
        StockUnit: parseInt(StockUnit),
        Price: parseInt(Price)
      };

      function clearFields() {
        document.getElementById('MaterialCod').selectedIndex = 0; // Resetea el select a la primera opción
        document.getElementById('editMaterialName').value = ''; // Limpia el campo de nombre
        document.getElementById('editMaterialDescription').value = ''; // Limpia el campo de descripción
        document.getElementById('editSupplier').selectedIndex = 0; // Resetea el select de proveedores
        document.getElementById('editStockQuantity').value = ''; // Limpia el campo de cantidad de stock
        document.getElementById('editUnit').selectedIndex = 0; // Resetea el select de unidad de medida

        document.getElementById('materialID').selectedIndex = 0; // Resetea el select a la primera opción
        document.getElementById('materialName').value = ''; // Limpia el campo de nombre
        document.getElementById('materialDescription').value = ''; // Limpia el campo de descripción
        document.getElementById('supplier').selectedIndex = 0; // Resetea el select de proveedores
        document.getElementById('stockQuantity').value = ''; // Limpia el campo de cantidad de stock
        document.getElementById('unit').selectedIndex = 0; // Resetea el select de unidad de medida

      }

      // Hacer la solicitud POST a la API
      fetch("http://localhost:63152/api/Materials", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(newMaterial)
      })
        .then(response => {
          if (response.ok) {
            alert("Material agregado exitosamente.");
            // Aquí puedes agregar código para actualizar la lista de materiales
            clearFields();
          } else {
            alert("Error al agregar el material.");
          }
        })
    }


    //Editar

    function confirmUpdateMaterial() {
      // Mensaje de confirmación
      const confirmUpdate = confirm("¿Desea realizar el cambio de material?");

      // Si el usuario acepta, se llama a la función de actualización
      if (confirmUpdate) {
        updateMaterial();
      } else {
        // Opcional: si el usuario cancela, puedes agregar un mensaje o simplemente no hacer nada
        console.log("Actualización cancelada por el usuario.");
      }
    }



    function updateMaterial() {
      // Obtiene los valores del formulario de edición
      const materialID = document.getElementById("materialID").value;
      const materialName = document.getElementById("editMaterialName").value;
      const materialDescription = document.getElementById("editMaterialDescription").value;
      const supplierID = document.getElementById("editSupplier").value;
      const stockQuantity = document.getElementById("editStockQuantity").value;
      const stockUnit = document.getElementById("editUnit").value;

      function clearFields() {
        document.getElementById('materialID').selectedIndex = 0; // Resetea el select a la primera opción
        document.getElementById('editMaterialName').value = ''; // Limpia el campo de nombre
        document.getElementById('editMaterialDescription').value = ''; // Limpia el campo de descripción
        document.getElementById('editSupplier').selectedIndex = 0; // Resetea el select de proveedores
        document.getElementById('editStockQuantity').value = ''; // Limpia el campo de cantidad de stock
        document.getElementById('editUnit').selectedIndex = 0; // Resetea el select de unidad de medida
      }


      // Llama a la API para actualizar el material
      debugger
      fetch(`http://localhost:63152/api/Materials/${materialID}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          MaterialID: parseInt(materialID),
          MaterialName: materialName,
          Description: materialDescription,
          SupplierID: parseInt(supplierID),
          StockQuantity: parseInt(stockQuantity),
          StockUnit: stockUnit,
        }),
      })
        .then((response) => {
          console.log("Respuesta del servidor:", response); // Log para ver la respuesta completa
          if (response.ok) {
            // Maneja respuestas exitosas
            if (response.status === 204) {
              alert("Material actualizado con éxito.");
              clearFields();
            } else {
              return response.json(); // Lee el cuerpo si no es un 204
            }
          } else {
            // Log para ver el error específico
            return response.text().then(text => {
              console.error("Error en la respuesta del servidor:", text); // Log del mensaje de error
              throw new Error(`Error en la solicitud: ${response.status} ${response.statusText}`);
            });
          }
        })
        .then((data) => {
          if (data) {
            console.log("Material actualizado con éxito:", data);
            alert("Material actualizado con éxito.");
            clearFields();
          }
        })
    }

    document.addEventListener("DOMContentLoaded", function () {
      const menuItems = document.querySelectorAll(".side-menu ul li a");

      menuItems.forEach((item) => {
        item.addEventListener("click", function () {
          const submenu = this.nextElementSibling;
          const isActive = submenu && submenu.style.display === "block";

          // Oculta todos los submenús
          document
            .querySelectorAll(".side-menu ul .submenu")
            .forEach((sub) => {
              sub.style.display = "none";
            });

          // Muestra el submenú si no está activo
          if (submenu && !isActive) {
            submenu.style.display = "block";
          }
        });
      });
    });
  </script>


  <script src="../Modal/modal-crud/dist/script.js"></script>
</body>

</html>